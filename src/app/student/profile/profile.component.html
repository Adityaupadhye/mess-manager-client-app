<app-navbar-student></app-navbar-student>

<div class="w-full min-h-screen flex justify-center bg-gray-50 py-12 px-4">
    <div class="bg-white shadow-xl rounded-3xl p-8 w-full max-w-lg">

        <!-- Profile Section -->
        <div class="flex flex-col items-center">
            <div class="relative">

                <!-- Avatar -->
                <div class="w-36 h-36 rounded-full bg-blue-50 border-4 border-blue-200 
             flex items-center justify-center shadow-lg">
                    <span class="material-icons text-blue-600 text-7xl">account_circle</span>
                </div>

                <!-- Pencil Icon (Click to Upload) -->
                <label for="profilePicInput" class="absolute bottom-2 right-2 bg-white rounded-full w-10 h-10 
             flex items-center justify-center shadow-md cursor-pointer 
             hover:bg-gray-100 active:bg-gray-200 transition">
                    <span class="material-icons text-blue-600 text-xl">edit</span>
                </label>

                <!-- Single File Input -->
                <input type="file" id="profilePicInput" accept="image/*" class="hidden"
                    (change)="onFileSelected($event)" />

            </div>

            <!-- Name -->
            <h2 class="mt-4 text-3xl font-bold text-gray-900 text-center">
                {{studentData.name}}
            </h2>

            <!-- Details -->
            <div class="mt-2 text-gray-600 text-center text-base leading-relaxed">
                <p class="font-medium"><span class="font-semibold text-gray-800">{{studentData.hostel}}</span></p>
                <p class="font-medium"><span class="font-semibold text-gray-800">{{studentData.roll_no}}</span></p>
            </div>
        </div>

        <!-- Divider -->
        <div class="border-t my-8"></div>

        <!-- QR Code Section -->
        <div class="flex flex-col items-center">
            <!-- Outer Grey Background -->
            <qrcode [qrdata]="studentJsonString" [width]="220" [errorCorrectionLevel]="'M'"
                class="rounded-lg overflow-hidden"></qrcode>


            <button (click)="refreshQR()" class="w-full text-center
         bg-black hover:bg-blue-700 active:bg-blue-900
         text-white py-3 rounded-xl
         transition-colors duration-200
         font-semibold flex items-center justify-center gap-2 cursor-pointer">
                <span class="material-icons">sync</span>
                Refresh QR Code
            </button>
        </div>

        <!-- Feedback & Rating Buttons -->
        <div class="mt-10 space-y-3">
            <button (click)="openFeedbackModal()"
                class="w-full py-3 rounded-xl shadow-md bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium flex items-center justify-center gap-2">
                <span class="material-icons">feedback</span>
                Give Feedback
            </button>

            <button (click)="openRatingModal()"
                class="w-full py-3 rounded-xl shadow-md bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-semibold flex items-center justify-center gap-2">
                <span class="material-icons">star_rate</span>
                Rate the App
            </button>
        </div>
    </div>
</div>


<!-- FEEDBACK MODAL -->
<div *ngIf="isFeedbackModalOpen"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">

    <div class="bg-white w-96 rounded-xl p-6 shadow-xl">

        <h2 class="text-xl font-semibold mb-3">Give Feedback</h2>

        <textarea [(ngModel)]="feedbackText"
            class="w-full h-32 p-3 border rounded-lg focus:ring-2 focus:ring-blue-400"
            placeholder="Write your feedback here..."></textarea>

        <div class="flex justify-end gap-3 mt-5">
            <button (click)="closeFeedbackModal()"
                class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                Cancel
            </button>

            <button (click)="submitFeedback()"
                class="px-4 py-2 bg-yellow-500 text-gray-900 rounded-lg hover:bg-blue-700">
                Submit
            </button>
        </div>

    </div>
</div>



<!--  RATING MODAL -->
<div *ngIf="isRatingModalOpen"
     class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">

    <div class="bg-white w-80 rounded-xl p-6 shadow-xl">

        <h2 class="text-xl font-semibold mb-3">Rate the App</h2>

        <!-- Star Rating -->
        <div class="flex justify-center text-4xl gap-1 cursor-pointer mb-4">

            <span *ngFor="let s of stars"
                  (click)="setRating(s)"
                  [ngClass]="s <= rating ? 'text-yellow-400' : 'text-gray-400'">
                â˜…
            </span>

        </div>

        <p class="text-center text-gray-600 text-sm">Select a star rating</p>

        <div class="flex justify-center gap-3 mt-5">
            <button (click)="closeRatingModal()"
                class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
                Cancel
            </button>

            <button (click)="submitRating()"
                class="px-4 py-2 bg-yellow-500 text-gray-900 rounded-lg hover:bg-yellow-600">
                Submit
            </button>
        </div>

    </div>
</div>
